
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <title>Resolving names, numbers, designations &#8212; rocks 0.1 documentation</title>
    <link rel="stylesheet" href="_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Asteroid Properties" href="properties.html" />
    <link rel="prev" title="Command-Line Interface" href="cli.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="properties.html" title="Asteroid Properties"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="cli.html" title="Command-Line Interface"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">rocks 0.1 documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="resolving-names-numbers-designations">
<h1>Resolving names, numbers, designations<a class="headerlink" href="#resolving-names-numbers-designations" title="Permalink to this headline">¶</a></h1>
<p><code class="docutils literal notranslate"><span class="pre">rocks</span></code> resolves identifying strings or numbers into the official number-name
pairs of minor bodies. Local lookups are emphasized by reformat input strings
with regular expressions (e.g. <code class="docutils literal notranslate"><span class="pre">'2014_yc62'</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">'2014</span> <span class="pre">YC62'</span></code>).
If the identifier cannot be resolved locally, <code class="docutils literal notranslate"><span class="pre">SsODNet:quaero</span></code> is queried.</p>
<p><code class="docutils literal notranslate"><span class="pre">SsODNet:quaero</span></code> keeps track of alias names, which comes in handy when
combining databases (e.g. <em>SDSS MOC4</em> and <em>VISTA MOVIS</em>).</p>
<div class="section" id="use-cases-and-examples">
<h2>Use cases and examples<a class="headerlink" href="#use-cases-and-examples" title="Permalink to this headline">¶</a></h2>
<p><strong>Quick lookups of asteroid names and numbers</strong>, via the command line. See
<a class="reference internal" href="cli.html#cli-identify"><span class="std std-ref">rocks identify</span></a>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ rocks identify <span class="s2">&quot;Rio de Janeiro&quot;</span>
<span class="o">(</span><span class="m">11334</span><span class="o">)</span> Rio de Janeiro
</pre></div>
</div>
<p><strong>Multiprocessed lookup of many asteroid identifiers</strong>, scripted. See the <a class="reference internal" href="#get-name-number">get_name_number</a>
function.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">rocks</span> <span class="kn">import</span> <span class="n">names</span>
</pre></div>
</div>
<p><strong>Merging databases containing alias names and distinct identifier formats</strong>, scripted.
See the <a class="reference internal" href="#get-name-number">get_name_number</a> function.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="kn">from</span> <span class="nn">rocks</span> <span class="kn">import</span> <span class="n">names</span>

<span class="c1"># Two databases with asteroids and associated magnitudes</span>
<span class="n">db1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;designation&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;2013JJ2&#39;</span><span class="p">,</span> <span class="s1">&#39;de Broglie&#39;</span><span class="p">],</span>
                         <span class="s1">&#39;mV&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">17</span><span class="p">,</span> <span class="mi">15</span><span class="p">]})</span>
<span class="n">db2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;designation&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Vermeer&#39;</span><span class="p">,</span> <span class="s1">&#39;2010_pa1&#39;</span><span class="p">,</span> <span class="s1">&#39;de Broglie&#39;</span><span class="p">],</span>
                         <span class="s1">&#39;mB&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">16.3</span><span class="p">,</span> <span class="mf">18.1</span><span class="p">,</span> <span class="mf">15.2</span><span class="p">]})</span>

<span class="c1"># Merge them</span>
<span class="n">merged</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">db1</span><span class="p">,</span> <span class="n">db2</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;designation&#39;</span><span class="p">,</span>
                  <span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;designation&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span><span class="p">)</span>

<span class="c1">#  designation    mV    mB</span>
<span class="c1">#      2013JJ2  17.0   NaN</span>
<span class="c1">#   de Broglie  15.0  15.2</span>
<span class="c1">#      Vermeer   NaN  16.3</span>
<span class="c1">#     2010_pa1   NaN  18.1</span>

<span class="c1"># Query name and number with rocks</span>
<span class="n">names_numbers</span> <span class="o">=</span> <span class="n">names</span><span class="o">.</span><span class="n">identify</span><span class="p">(</span><span class="n">merged</span><span class="p">[</span><span class="s1">&#39;designation&#39;</span><span class="p">],</span> <span class="n">parallel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                               <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">merged</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">merged</span><span class="p">[</span><span class="s1">&#39;number&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">names_numbers</span><span class="p">)</span>
<span class="n">merged</span> <span class="o">=</span> <span class="n">merged</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;designation&#39;</span><span class="p">])</span>

<span class="c1">#       name   number   mV    mB</span>
<span class="c1">#   2010 PA1      NaN 17.0   NaN</span>
<span class="c1"># de Broglie  30883.0 15.0  15.2</span>
<span class="c1">#    Vermeer   4928.0  NaN  16.3</span>
<span class="c1">#   2010 PA1      NaN  NaN  18.1</span>

<span class="c1"># Two of them are the same object. Collapse rows</span>
<span class="n">merged</span> <span class="o">=</span> <span class="n">merged</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">last</span><span class="p">()</span>

<span class="c1">#       name   number    mB    mV</span>
<span class="c1">#   2010 PA1      NaN  18.1  17.0</span>
<span class="c1">#    Vermeer   4928.0  16.3   NaN</span>
<span class="c1"># de Broglie  30883.0  15.2  15.0</span>
</pre></div>
</div>
</div>
<div class="section" id="control-flow-of-name-resolution">
<h2>Control flow of name resolution<a class="headerlink" href="#control-flow-of-name-resolution" title="Permalink to this headline">¶</a></h2>
<p>Some design choices:</p>
<ul class="simple">
<li><p>Always return a tuple</p></li>
<li><p>Return number, name</p></li>
<li><p>Return types are int, str when possible</p></li>
<li><p>If asteroid is not numbered, return np.nan</p></li>
<li><p>If identifier could not be resolved, return (None, None)</p></li>
<li><p>Name queries are cached at runtime</p></li>
</ul>
<div class="figure align-center" id="name-resolution">
<div class="graphviz"><object data="_images/graphviz-fde3576368d7f44a709ed048b160d8649a62fef8.svg" type="image/svg+xml" class="graphviz">
<p class="warning">digraph G {
      cli [label=&quot;Command Line&quot;, tooltip=&quot;rocks identify&quot;];
      script [tooltip=&quot;rocks.name.identify()&quot;, label=&quot;Script&quot;];
      identifier [shape=polygon, skew=0.2, fontname=Courier, label=&quot;Identifier&quot;,
                   width=1.4, fixedsize=true, tooltip=&quot;'2004es' 4, 'ceres'&quot;];
      bouncer [shape=diamond, height=1, label=&quot;Valid Identifier&quot;,
               tooltip=&quot;isinstance(id_, (str, int, float)&quot;];
      formatting [shape=box, label=&quot;Formatting&quot;,
                  tooltip=&quot;Find type of identifier with regex, ensure proper format&quot;];
      wrongid [shape=plaintext, fontname=Courier, label=&quot;return None, None&quot;];
      format [shape=diamond, height=1, label=&quot;Recognized Format&quot;, tooltip=&quot;Name, Designation, Comet&quot;];
      local [shape=folder, label=&quot;Local Index&quot;, tooltip=&quot;rocks index&quot;];
      remote [shape=polygon, label=&quot;SsODNet&quot;, tooltip=&quot;Result is cached at runtime&quot;];
      found [shape=diamond, height=1, label=&quot;Lookup Successful&quot;, tooltip=&quot;&quot;];
      good [shape=plaintext, fontname=Courier, label=&quot;return number, name&quot;];
      identified [shape=diamond, height=1, label=&quot;Identified&quot;, tooltip=&quot;&quot;];

      cli -&gt; identifier;
      script-&gt; identifier;
      identifier -&gt; bouncer;
      bouncer -&gt; formatting [label=True, fontname=Courier];
      bouncer -&gt; wrongid [label=False, fontname=Courier];
      formatting -&gt; format;
      format -&gt; local [label=True, fontname=Courier];
      format -&gt; remote [label=False, fontname=Courier];
      local -&gt; found;
      found -&gt; good [label=True, fontname=Courier];
      found -&gt; remote [label=False, fontname=Courier];
      remote -&gt; identified;
      identified -&gt; good [label=True, fontname=Courier];
      identified -&gt; wrongid [label=False, fontname=Courier];

 }</p></object></div>
<p class="caption"><span class="caption-text">Flowchart for resolution of asteroid identifier to Number-Name pair.
Hover over steps to get more information.</span><a class="headerlink" href="#name-resolution" title="Permalink to this image">¶</a></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">names.get_name_number</span></code> function first tries to do a local lookup of the
asteroid identifier, using the index file. If this fails, it queries Quaero.
The results are cached during runtime to profit from repeated queries.
It offers multiprocessing the queries.</p>
<p>The query speed largely depends on the number of successful local lookups.
Asteroid numbers should be prioritized as identifiers. A small benchmark using 260,000 lines from the SDSS MOC4:</p>
<ul class="simple">
<li><p>Serial mode: 80 queries / s</p></li>
<li><p>Parallel mode (4 cores): 380 queries / s</p></li>
<li><p>Parallel mode (8 cores): 870 queries / s</p></li>
</ul>
<span class="target" id="get-name-number"></span><dl class="py function">
<dt id="names.get_name_number">
<code class="sig-prename descclassname">names.</code><code class="sig-name descname">get_name_number</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">this</span></em>, <em class="sig-param"><span class="n">parallel</span><span class="o">=</span><span class="default_value">4</span></em>, <em class="sig-param"><span class="n">verbose</span><span class="o">=</span><span class="default_value">True</span></em>, <em class="sig-param"><span class="n">progress</span><span class="o">=</span><span class="default_value">True</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/names.html#get_name_number"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#names.get_name_number" title="Permalink to this definition">¶</a></dt>
<dd><p>Get SSO name and number from an identifier.</p>
<p>Does a local lookup for asteroid identifier in the index. If this fails,
queries SsODNet:quaero. Can be passed a list of identifiers.
Parallel queries by default.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>this</strong> (<em>str</em><em>, </em><em>int</em><em>, </em><em>float</em><em>, </em><em>list</em><em>, </em><em>np.array</em><em>, </em><em>pd.Series</em>) – Asteroid name, designation, or number.</p></li>
<li><p><strong>parallel</strong> (<em>int</em>) – Number of cores to use for queries. Default is 4.</p></li>
<li><p><strong>verbose</strong> (<em>bool</em>) – Print request diagnostics. Default is True.</p></li>
<li><p><strong>progress</strong> (<em>bool</em>) – Show query progress. Default is True.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Tuple containing asteroid name or designation as str and
asteroid number as int, NaN if not numbered. If input was list of
identifiers, returns a list of tuples</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>tuple, (str, int or float)</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Use integer asteroid numbers as identifiers for fastest queries. Asteroid
names or designations are queried case- and whitespace-insensitive.</p>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">rocks</span> <span class="kn">import</span> <span class="n">names</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">names_numbers</span> <span class="o">=</span> <span class="n">names</span><span class="o">.</span><span class="n">get_name_number</span><span class="p">([</span><span class="s1">&#39;1950 RW&#39;</span><span class="p">,</span> <span class="s1">&#39;2001je2&#39;</span><span class="p">,</span> <span class="s1">&#39;VESTA&#39;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">names_numbers</span><span class="p">)</span>
<span class="go">[(&#39;Gyldenkerne&#39;, 5030), (&#39;2001 JE2&#39;, 131353), (&#39;Vesta&#39;, 4)]</span>
</pre></div>
</div>
</dd></dl>

<p>When saving asteroid data, the name or designation is a handy unique identifier
for the filename. The whitespace in the designations is, however, not
convenient. The function below removes troublesome characters.</p>
<dl class="py function">
<dt id="names.to_filename">
<code class="sig-prename descclassname">names.</code><code class="sig-name descname">to_filename</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">name</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/names.html#to_filename"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#names.to_filename" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates suitable filename from asteroid name or designation.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>name</strong> (<em>str</em>) – Asteroid name or designation</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Sanitized asteroid name.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">rocks</span> <span class="kn">import</span> <span class="n">names</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">names</span><span class="o">.</span><span class="n">to_filename</span><span class="p">(</span><span class="s2">&quot;G!kun||&#39;homdima&quot;</span><span class="p">)</span>
<span class="go">&#39;Gkunhomdima&#39;</span>
</pre></div>
</div>
<dl>
<dt>..digraph “sphinx-ext-graphviz” {</dt><dd><p>..size=”6,4”;
..rankdir=”LR”;
..graph [fontname=”Verdana”, fontsize=”12”];
..node [fontname=”Verdana”, fontsize=”12”];
..edge [fontname=”Sans”, fontsize=”9”];</p>
<dl class="simple">
<dt>..sphinx [label=”Sphinx”, shape=”component”,</dt><dd><p>..href=”<a class="reference external" href="https://www.sphinx-doc.org/">https://www.sphinx-doc.org/</a>”,
..target=”_blank”];</p>
</dd>
<dt>..dot [label=”GraphViz”, shape=”component”,</dt><dd><p>..href=”<a class="reference external" href="https://www.graphviz.org/">https://www.graphviz.org/</a>”,
..target=”_blank”];</p>
</dd>
<dt>..docs [label=”Docs (.rst)”, shape=”folder”,</dt><dd><p>..fillcolor=green, style=filled];</p>
</dd>
<dt>..svg_file [label=”SVG Image”, shape=”note”, fontcolor=white,</dt><dd><p>..fillcolor=”#3333ff”, style=filled];</p>
</dd>
<dt>..html_files [label=”HTML Files”, shape=”folder”,</dt><dd><p>..fillcolor=yellow, style=filled];</p>
</dd>
</dl>
<p>..docs -&gt; sphinx [label=” parse “];
..sphinx -&gt; dot [label=” call “, style=dashed, arrowhead=none];
..dot -&gt; svg_file [label=” draw “];
..sphinx -&gt; html_files [label=” render “];
..svg_file -&gt; html_files [style=dashed];</p>
</dd>
</dl>
<p>..}</p>
</dd></dl>

</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Resolving names, numbers, designations</a><ul>
<li><a class="reference internal" href="#use-cases-and-examples">Use cases and examples</a></li>
<li><a class="reference internal" href="#control-flow-of-name-resolution">Control flow of name resolution</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="cli.html"
                        title="previous chapter">Command-Line Interface</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="properties.html"
                        title="next chapter">Asteroid Properties</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/names.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="properties.html" title="Asteroid Properties"
             >next</a> |</li>
        <li class="right" >
          <a href="cli.html" title="Command-Line Interface"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">rocks 0.1 documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2020, Max Mahlke, Benoit Carry.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.0.3.
    </div>
  </body>
</html>